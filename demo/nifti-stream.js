"use strict";var niftiStream=(()=>{var T=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var B=a=>{throw TypeError(a)};var k=(a,e)=>{for(var n in e)T(a,n,{get:e[n],enumerable:!0})},z=(a,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $(e))!H.call(a,i)&&i!==n&&T(a,i,{get:()=>e[i],enumerable:!(t=_(e,i))||t.enumerable});return a};var L=a=>z(T({},"__esModule",{value:!0}),a);var M=(a,e,n)=>e.has(a)||B("Cannot "+n);var u=(a,e,n)=>(M(a,e,"read from private field"),n?n.call(a):e.get(a)),F=(a,e,n)=>e.has(a)?B("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,n),x=(a,e,n,t)=>(M(a,e,"write to private field"),t?t.call(a,n):e.set(a,n),n);var G={};k(G,{DataTypeCode:()=>D,NiftiExtension:()=>N,NiftiHeader:()=>I,NiftiIOError:()=>f,NiftiStream:()=>q,NiftiVersion:()=>P,TransformCode:()=>w,UnitsCode:()=>U});var f=class extends Error{constructor(e){super(e),this.name="NiftiIOError"}};var D=(d=>(d[d.UINT8=2]="UINT8",d[d.INT16=4]="INT16",d[d.INT32=8]="INT32",d[d.FLOAT32=16]="FLOAT32",d[d.FLOAT64=64]="FLOAT64",d[d.RGB24=128]="RGB24",d[d.INT8=256]="INT8",d[d.UINT16=512]="UINT16",d[d.UINT32=768]="UINT32",d[d.INT64=1024]="INT64",d[d.UINT64=1280]="UINT64",d))(D||{}),w=(i=>(i[i.SCANNER_ANAT=1]="SCANNER_ANAT",i[i.ALIGNED_ANAT=2]="ALIGNED_ANAT",i[i.TALAIRACH=3]="TALAIRACH",i[i.MNI_152=4]="MNI_152",i))(w||{}),U=(l=>(l[l.METER=1]="METER",l[l.MM=2]="MM",l[l.MICRON=3]="MICRON",l[l.SEC=8]="SEC",l[l.MSEC=16]="MSEC",l[l.USEC=24]="USEC",l[l.HZ=32]="HZ",l[l.PPM=40]="PPM",l[l.RADS=48]="RADS",l))(U||{}),Z=new Map([[2,"Uint8 (1 byte)"],[4,"Int16 (2 bytes)"],[8,"Int32 (4 bytes)"],[16,"Float32 (4 bytes)"],[64,"Float64 (8 bytes)"],[128,"RGB (24-bit)"],[256,"Int8 (1 byte)"],[512,"Uint16 (2 bytes)"],[768,"Uint32 (4 bytes)"],[1024,"Int64 (8 bytes)"],[1280,"Uint64 (8 bytes)"]]),Y=new Map([[1,"Scanner Anatomical"],[2,"Aligned Anatomical"],[3,"Talairach Space"],[4,"MNI-152 Space"]]),X=new Map([[1,"Meters (m)"],[2,"Millimeters (mm)"],[3,"Micrometers (\u03BCm)"],[8,"Seconds (s)"],[16,"Milliseconds (ms)"],[24,"Microseconds (\u03BCs)"],[32,"Hertz (Hz)"],[40,"Parts per Million (ppm)"],[48,"Radians (rad)"]]),A=7,S=56;function C(a){return Z.get(a)??"Unknown"}function R(a){return Y.get(a)??"Unknown"}function O(a){return X.get(a)??"Unknown"}var m=348,p=540;var b,g,y,E,N=class{constructor({esize:e,ecode:n,edata:t,littleEndian:i}){F(this,b);F(this,g);F(this,y);F(this,E);if(e%16!==0)throw new Error("Invalid NIFTI extension: size must be divisible by 16");x(this,b,e),x(this,g,n),x(this,y,t),x(this,E,i)}get size(){return u(this,b)}get code(){return u(this,g)}get data(){return u(this,y)}get littleEndian(){return u(this,E)}toArrayBuffer(){let e=new Uint8Array(u(this,b)),n=new Uint8Array(u(this,y)),t=new DataView(e.buffer);return t.setInt32(0,u(this,b),u(this,E)),t.setInt32(4,u(this,g),u(this,E)),e.set(n,8),e.buffer}};b=new WeakMap,g=new WeakMap,y=new WeakMap,E=new WeakMap;function c(a,e,n){let t=new Uint8Array(a.buffer,e,n-e),i=t.indexOf(0),s=i===-1?t:t.slice(0,i);return new TextDecoder("ascii").decode(s)}var P=(s=>(s[s.NIFTI1=1]="NIFTI1",s[s.NIFTI1_PAIR=2]="NIFTI1_PAIR",s[s.NIFTI2=3]="NIFTI2",s[s.NIFTI2_PAIR=4]="NIFTI2_PAIR",s[s.NONE=5]="NONE",s))(P||{}),I=class a{constructor(){this.dimInfo=0;this.dims=[0,0,0,0,0,0,0,0];this.intentP1=0;this.intentP2=0;this.intentP3=0;this.intentCode=0;this.datatypeCode=0;this.numBitsPerVoxel=0;this.sliceStart=0;this.pixDims=[0,0,0,0,0,0,0,0];this.voxOffset=0;this.dataSlope=1;this.dataIntercept=0;this.sliceEnd=0;this.sliceCode=0;this.xyztUnits=0;this.calibrationMax=0;this.calibrationMin=0;this.sliceDuration=0;this.timeOffset=0;this.description="";this.auxilaryFile="";this.qFormCode=0;this.sFormCode=0;this.sRowX=[0,0,0,0];this.sRowY=[0,0,0,0];this.sRowZ=[0,0,0,0];this.quaternB=0;this.quaternC=0;this.quaternD=0;this.qOffsetX=0;this.qOffsetY=0;this.qOffsetZ=0;this.intentName="";this.magic="ni1";this.littleEndian=!1}isValid(){return this.getNiftiVersion()!==5}getNiftiVersion(){return{"n+1":1,ni1:2,"n+2":3,ni2:4}[this.magic]||5}getNiftiVersionDisplayName(){return{5:"Unknown",1:"NIFTI-1 (Single File)",2:"NIFTI-1 (Paired Files)",3:"NIFTI-2 (Single File)",4:"NIFTI-2 (Paired Files)"}[this.getNiftiVersion()]}getDatatypeDisplayName(){return C(this.datatypeCode)}getQFormDisplayName(){return R(this.qFormCode)}getSFormDisplayName(){return R(this.sFormCode)}get spatialUnits(){return this.xyztUnits&A}set spatialUnits(e){this.xyztUnits=this.xyztUnits&~A|e&A}get temporalUnits(){return this.xyztUnits&S}set temporalUnits(e){this.xyztUnits=this.xyztUnits&~S|e&S}getSpatialUnitsDisplayName(){return O(this.spatialUnits)}getTemporalUnitsDisplayName(){return O(this.temporalUnits)}computeAffine(){let e=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];if(this.qFormCode<1&&this.sFormCode<1)e[0][0]=this.pixDims[1],e[1][1]=this.pixDims[2],e[2][2]=this.pixDims[3];else if(this.qFormCode>0&&this.sFormCode<this.qFormCode){let n=Math.sqrt(1-(Math.pow(this.quaternB,2)+Math.pow(this.quaternC,2)+Math.pow(this.quaternD,2))),t=this.quaternB,i=this.quaternC,s=this.quaternD,r=this.pixDims[0]===0?1:this.pixDims[0],o=[[n*n+t*t-i*i-s*s,2*t*i-2*n*s,2*t*s+2*n*i],[2*t*i+2*n*s,n*n+i*i-t*t-s*s,2*i*s-2*n*t],[2*t*s-2*n*i,2*i*s+2*n*t,n*n+s*s-i*i-t*t]];for(let h=0;h<3;h+=1)for(let l=0;l<3;l+=1)e[h][l]=o[h][l]*this.pixDims[l+1],l===2&&(e[h][l]*=r);e[0][3]=this.qOffsetX,e[1][3]=this.qOffsetY,e[2][3]=this.qOffsetZ}else if(this.sFormCode>0){let n=[this.sRowX,this.sRowY,this.sRowZ];for(let t=0;t<3;t+=1)for(let i=0;i<4;i+=1)e[t][i]=n[t][i]}return e}formatHeader(){let e=i=>Number.isInteger(i)?i.toString():i.toFixed(4),n=(i,s=" \xD7 ")=>i.map(e).join(s),t=i=>i.map(r=>r.map(o=>o.toFixed(4).padStart(12)).join("  ")).map(r=>"    "+r).join(`
`);return`# Image Properties
- Endianness: ${this.littleEndian?"Little":"Big"}
- Version: ${this.getNiftiVersionDisplayName()}
- Datatype: ${this.getDatatypeDisplayName()} [${this.datatypeCode}]
- Bits/Voxel: ${this.numBitsPerVoxel}
- Dimensions: ${n(this.dims)}
- Voxel Size: ${n(this.pixDims)}

# Transform Information
- Q-Form: ${this.getQFormDisplayName()} [${this.qFormCode}]
- S-Form: ${this.getSFormDisplayName()} [${this.sFormCode}]
- Quaternion B/C/D: ${e(this.quaternB)} / ${e(this.quaternC)} / ${e(this.quaternD)}
- Q-Offset: ${n([this.qOffsetX,this.qOffsetY,this.qOffsetZ],", ")}
- S-Form Rows:
    X: ${n(this.sRowX,", ")}
    Y: ${n(this.sRowY,", ")}
    Z: ${n(this.sRowZ,", ")}

# Affine Matrix (computed):
${t(this.computeAffine())}

# Units & Scaling
- Spatial Units: ${this.getSpatialUnitsDisplayName()} [${this.spatialUnits}]
- Temporal Units: ${this.getTemporalUnitsDisplayName()} [${this.temporalUnits}]
- Scale Slope: ${e(this.dataSlope)}
- Scale Intercept: ${e(this.dataIntercept)}
- Display Range: ${e(this.calibrationMin)} to ${e(this.calibrationMax)}

# Intent & Metadata
- Intent: '${this.intentName||"none"}' [${this.intentCode}]
- Intent Params: ${e(this.intentP1)} / ${e(this.intentP2)} / ${e(this.intentP3)}
- Description: '${this.description||"none"}'
- Auxiliary File: '${this.auxilaryFile||"none"}'`}static peekVersion(e){if(e.byteLength<4)throw new f("Not enough bytes to identify NIFTI header.");switch(e.getInt32(0,!1)){case 348:return{nifti1:!0,littleEndian:!1};case 1543569408:return{nifti1:!0,littleEndian:!0};case 540:return{nifti1:!1,littleEndian:!1};case 469893120:return{nifti1:!1,littleEndian:!0};default:return}}static parse(e,n){return n.nifti1?this.parseNifti1(e,n.littleEndian):this.parseNifti2(e,n.littleEndian)}static parseNifti1(e,n){if(e.byteLength<m)throw new f("Not enough bytes to parse NIFTI-1 header.");let t=new a;if(n===void 0){let s=a.peekVersion(e);if(s===void 0||!s.nifti1)throw new f("This does not appear to be a NIFTI-1 file!");t.littleEndian=s.littleEndian}else t.littleEndian=n;t.dimInfo=e.getInt8(39);for(let s=0;s<8;s+=1){let r=40+s*2;t.dims[s]=e.getInt16(r,t.littleEndian)}t.intentP1=e.getFloat32(56,t.littleEndian),t.intentP2=e.getFloat32(60,t.littleEndian),t.intentP3=e.getFloat32(64,t.littleEndian),t.intentCode=e.getInt16(68,t.littleEndian),t.datatypeCode=e.getInt16(70,t.littleEndian),t.numBitsPerVoxel=e.getInt16(72,t.littleEndian),t.sliceStart=e.getInt16(74,t.littleEndian);for(let s=0;s<8;s+=1){let r=76+s*4;t.pixDims[s]=e.getFloat32(r,t.littleEndian)}t.voxOffset=e.getFloat32(108,t.littleEndian),t.dataSlope=e.getFloat32(112,t.littleEndian),t.dataIntercept=e.getFloat32(116,t.littleEndian),t.sliceEnd=e.getInt16(120,t.littleEndian),t.sliceCode=e.getInt8(122),t.xyztUnits=e.getInt8(123),t.calibrationMax=e.getFloat32(124,t.littleEndian),t.calibrationMin=e.getFloat32(128,t.littleEndian),t.sliceDuration=e.getFloat32(132,t.littleEndian),t.timeOffset=e.getFloat32(136,t.littleEndian),t.description=c(e,148,228),t.auxilaryFile=c(e,228,252),t.qFormCode=e.getInt16(252,t.littleEndian),t.sFormCode=e.getInt16(254,t.littleEndian),t.quaternB=e.getFloat32(256,t.littleEndian),t.quaternC=e.getFloat32(260,t.littleEndian),t.quaternD=e.getFloat32(264,t.littleEndian),t.qOffsetX=e.getFloat32(268,t.littleEndian),t.qOffsetY=e.getFloat32(272,t.littleEndian),t.qOffsetZ=e.getFloat32(276,t.littleEndian);let i=[t.sRowX,t.sRowY,t.sRowZ];for(let s=0;s<3;s+=1)for(let r=0;r<4;r+=1){let o=280+(s*4+r)*4;i[s][r]=e.getFloat32(o,t.littleEndian)}return t.intentName=c(e,328,344),t.magic=c(e,344,348),t}static parseNifti2(e,n){if(e.byteLength<p)throw new f("Not enough bytes to parse NIFTI-2 header.");let t=new a;if(n===void 0){let s=a.peekVersion(e);if(s===void 0||s.nifti1)throw new f("This does not appear to be a NIFTI-2 file!");t.littleEndian=s.littleEndian}else t.littleEndian=n;t.magic=c(e,4,12),t.datatypeCode=e.getInt16(12,t.littleEndian),t.numBitsPerVoxel=e.getInt16(14,t.littleEndian);for(let s=0;s<8;s+=1){let r=16+s*8;t.dims[s]=Number(e.getBigInt64(r,t.littleEndian))}t.intentP1=e.getFloat64(80,t.littleEndian),t.intentP2=e.getFloat64(88,t.littleEndian),t.intentP3=e.getFloat64(96,t.littleEndian);for(let s=0;s<8;s+=1){let r=104+s*8;t.pixDims[s]=e.getFloat64(r,t.littleEndian)}t.voxOffset=Number(e.getBigInt64(168,t.littleEndian)),t.dataSlope=e.getFloat64(176,t.littleEndian),t.dataIntercept=e.getFloat64(184,t.littleEndian),t.calibrationMax=e.getFloat64(192,t.littleEndian),t.calibrationMin=e.getFloat64(200,t.littleEndian),t.sliceDuration=e.getFloat64(208,t.littleEndian),t.timeOffset=e.getFloat64(216,t.littleEndian),t.sliceStart=Number(e.getBigInt64(224,t.littleEndian)),t.sliceEnd=Number(e.getBigInt64(232,t.littleEndian)),t.description=c(e,240,320),t.auxilaryFile=c(e,320,344),t.qFormCode=e.getInt32(344,t.littleEndian),t.sFormCode=e.getInt32(348,t.littleEndian),t.quaternB=e.getFloat64(352,t.littleEndian),t.quaternC=e.getFloat64(360,t.littleEndian),t.quaternD=e.getFloat64(368,t.littleEndian),t.qOffsetX=e.getFloat64(376,t.littleEndian),t.qOffsetY=e.getFloat64(384,t.littleEndian),t.qOffsetZ=e.getFloat64(392,t.littleEndian);let i=[t.sRowX,t.sRowY,t.sRowZ];for(let s=0;s<3;s+=1)for(let r=0;r<4;r+=1){let o=280+(s*4+r)*4;i[s][r]=e.getFloat64(o,t.littleEndian)}return t.sliceCode=e.getInt32(496,t.littleEndian),t.xyztUnits=e.getInt32(500,t.littleEndian),t.intentCode=e.getInt32(504,t.littleEndian),t.intentName=c(e,508,524),t.dimInfo=e.getInt8(524),t}serializeNifti1(){let e=m,n=new TextEncoder,t=new Uint8Array(e),i=new DataView(t.buffer);i.setInt32(0,m,this.littleEndian),i.setUint8(39,this.dimInfo);for(let o=0;o<8;o++)i.setUint16(40+2*o,this.dims[o],this.littleEndian);i.setFloat32(56,this.intentP1,this.littleEndian),i.setFloat32(60,this.intentP2,this.littleEndian),i.setFloat32(64,this.intentP3,this.littleEndian),i.setInt16(68,this.intentCode,this.littleEndian),i.setInt16(70,this.datatypeCode,this.littleEndian),i.setInt16(72,this.numBitsPerVoxel,this.littleEndian),i.setInt16(74,this.sliceStart,this.littleEndian);for(let o=0;o<8;o++)i.setFloat32(76+4*o,this.pixDims[o],this.littleEndian);i.setFloat32(108,this.voxOffset,this.littleEndian),i.setFloat32(112,this.dataSlope,this.littleEndian),i.setFloat32(116,this.dataIntercept,this.littleEndian),i.setInt16(120,this.sliceEnd,this.littleEndian),i.setUint8(122,this.sliceCode),i.setUint8(123,this.xyztUnits),i.setFloat32(124,this.calibrationMax,this.littleEndian),i.setFloat32(128,this.calibrationMin,this.littleEndian),i.setFloat32(132,this.sliceDuration,this.littleEndian),i.setFloat32(136,this.timeOffset,this.littleEndian),t.set(n.encode(this.description.slice(0,80)),148),t.set(n.encode(this.auxilaryFile.slice(0,24)),228),i.setInt16(252,this.qFormCode,this.littleEndian),i.setInt16(254,this.sFormCode,this.littleEndian),i.setFloat32(256,this.quaternB,this.littleEndian),i.setFloat32(260,this.quaternC,this.littleEndian),i.setFloat32(264,this.quaternD,this.littleEndian),i.setFloat32(268,this.qOffsetX,this.littleEndian),i.setFloat32(272,this.qOffsetY,this.littleEndian),i.setFloat32(276,this.qOffsetZ,this.littleEndian);let s=[this.sRowX,this.sRowY,this.sRowZ];for(let o=0;o<3;o++)for(let h=0;h<4;h++)i.setFloat32(280+(o*4+h)*4,s[o][h],this.littleEndian);t.set(n.encode(this.intentName.slice(0,16)),328);let r;switch(this.magic){case"ni2":r="ni1";break;case"n+2":r="n+1";break;default:r=this.magic}return t.set(n.encode(r.slice(0,3)),344),t}serializeNifti2(){let e=new TextEncoder,n=new Uint8Array(p),t=new DataView(n.buffer);t.setInt32(0,p,this.littleEndian);let i;switch(this.magic){case"ni1":i="ni2";break;case"n+1":i="n+2";break;default:i=this.magic}n.set(e.encode(i.slice(0,3)),4),t.setInt16(12,this.datatypeCode,this.littleEndian),t.setInt16(14,this.numBitsPerVoxel,this.littleEndian);for(let r=0;r<8;r++)t.setBigInt64(16+8*r,BigInt(this.dims[r]),this.littleEndian);t.setFloat64(80,this.intentP1,this.littleEndian),t.setFloat64(88,this.intentP2,this.littleEndian),t.setFloat64(96,this.intentP3,this.littleEndian);for(let r=0;r<8;r++)t.setFloat64(104+8*r,this.pixDims[r],this.littleEndian);t.setBigInt64(168,BigInt(this.voxOffset),this.littleEndian),t.setFloat64(176,this.dataSlope,this.littleEndian),t.setFloat64(184,this.dataIntercept,this.littleEndian),t.setFloat64(192,this.calibrationMax,this.littleEndian),t.setFloat64(200,this.calibrationMin,this.littleEndian),t.setFloat64(208,this.sliceDuration,this.littleEndian),t.setFloat64(216,this.timeOffset,this.littleEndian),t.setBigInt64(224,BigInt(this.sliceStart),this.littleEndian),t.setBigInt64(232,BigInt(this.sliceEnd),this.littleEndian),n.set(e.encode(this.description.slice(0,80)),240),n.set(e.encode(this.auxilaryFile.slice(0,24)),320),t.setInt32(344,this.qFormCode,this.littleEndian),t.setInt32(348,this.sFormCode,this.littleEndian),t.setFloat64(352,this.quaternB,this.littleEndian),t.setFloat64(360,this.quaternC,this.littleEndian),t.setFloat64(368,this.quaternD,this.littleEndian),t.setFloat64(376,this.qOffsetX,this.littleEndian),t.setFloat64(384,this.qOffsetY,this.littleEndian),t.setFloat64(392,this.qOffsetZ,this.littleEndian);let s=[this.sRowX,this.sRowY,this.sRowZ];for(let r=0;r<3;r++)for(let o=0;o<4;o++)t.setFloat64(400+(r*4+o)*8,s[r][o],this.littleEndian);return t.setInt32(496,this.sliceCode,this.littleEndian),t.setInt32(500,this.xyztUnits,this.littleEndian),t.setInt32(504,this.intentCode,this.littleEndian),n.set(e.encode(this.intentName.slice(0,16)),508),t.setUint8(524,this.dimInfo),n.buffer}};async function V(a){let e=a.getReader(),{done:n,value:t}=await e.read();if(n)return e.releaseLock(),new ReadableStream({start(r){r.close()}});if(!t||t.length<2)return e.releaseLock(),new ReadableStream({start(r){t&&r.enqueue(t),r.close()}});let i=t[0]===31&&t[1]===139,s=new ReadableStream({async start(r){try{for(r.enqueue(t);;){let{done:o,value:h}=await e.read();if(o){r.close(),e.releaseLock();break}r.enqueue(h)}}catch(o){r.error(o),e.releaseLock()}}});return i?s.pipeThrough(new DecompressionStream("gzip")):s}var q=class{constructor(e,n){this.options=n;this.header=null;this.stopped=!1;this.buffer=new Uint8Array(0);this.bufferOffset=0;this.dataPosition=0;this.stream=e}async setup(){let e=await V(this.stream);e&&(this.stream=e),this.reader=this.stream.getReader()}async stop(){this.stopped=!0,await this.reader?.cancel()}async readBytes(e){if(!this.reader)throw new f("Reader not initialized");if(this.buffer.length-this.bufferOffset>=e){let n=this.buffer.slice(this.bufferOffset,this.bufferOffset+e);return this.bufferOffset+=e,n}if(this.buffer.length-this.bufferOffset>0){let n=this.buffer.slice(this.bufferOffset),{done:t,value:i}=await this.reader.read();if(t){if(n.length<e)throw new f(`Unexpected end of stream: needed ${e} bytes but got ${n.length}`);return n}return this.buffer=new Uint8Array(n.length+i.length),this.buffer.set(n),this.buffer.set(i,n.length),this.bufferOffset=0,this.readBytes(e)}else{let{done:n,value:t}=await this.reader.read();if(n)throw new f(`Unexpected end of stream: needed ${e} bytes but got 0`);return this.buffer=t,this.bufferOffset=0,this.readBytes(e)}}async readHeader(){let e=await this.readBytes(m),n=I.peekVersion(new DataView(e.buffer));if(!n)throw new f("Not a valid NIFTI file");if(!n.nifti1){let t=await this.readBytes(p-m),i=new Uint8Array(p);return i.set(e),i.set(t,m),I.parseNifti2(new DataView(i.buffer),n.littleEndian)}return I.parseNifti1(new DataView(e.buffer),n.littleEndian)}async readExtension(){if(!this.header||!this.reader)throw new f("Cannot read extension before header");if((await this.readBytes(4))[0]===0)return null;let n=await this.readBytes(8),t=this.header.littleEndian,i=new DataView(n.buffer),s=i.getInt32(0,t),r=i.getInt32(4,t),o=s-8,h=await this.readBytes(o);return new N({esize:s,ecode:r,edata:h.buffer,littleEndian:t})}async readNextSlice(){if(!this.header)throw new f("Cannot read slice before header");if(!this.options.sliceDimension){if(this.dataPosition===0&&this.buffer.length>this.bufferOffset){let o=this.buffer.slice(this.bufferOffset);return this.buffer=new Uint8Array(0),this.bufferOffset=0,this.dataPosition++,{data:o.buffer,indices:[]}}let{done:s,value:r}=await this.reader.read();return s?null:(this.dataPosition++,{data:r.buffer,indices:[]})}let e=this.header.dims[0],n=this.header.dims,i=this.header.numBitsPerVoxel/8;for(let s=1;s<=(this.options.sliceDimension||2);s++)n[s]>0&&(i*=n[s]);try{let s=await this.readBytes(i),r=new Array(e).fill(0);return r[this.options.sliceDimension+1]=this.dataPosition++,{data:s.buffer,indices:r}}catch(s){if(s instanceof f)return null;throw s}}async start(){if(await this.setup(),!!this.reader)try{if(this.stopped)return;if(this.header=await this.readHeader(),this.options.onHeader){if(await this.options.onHeader(this.header)){await this.stop();return}}else if(!this.options.onExtension&&!this.options.onSlice){await this.stop();return}if(!this.stopped){let e=await this.readExtension();if(this.options.onExtension){if(await this.options.onExtension(e)){await this.stop();return}}else if(!this.options.onSlice){await this.stop();return}}if(!this.options.onSlice){await this.stop();return}for(;!this.stopped;){let e=await this.readNextSlice();if(!e)break;if(await this.options.onSlice(e.data,e.indices,this.header)){await this.stop();break}}}catch(e){this.options.onError&&this.options.onError(e)}finally{this.reader.releaseLock()}}};return L(G);})();
//# sourceMappingURL=nifti-stream.js.map
