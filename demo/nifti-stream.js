"use strict";var niftiStream=(()=>{var S=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var R=a=>{throw TypeError(a)};var k=(a,e)=>{for(var n in e)S(a,n,{get:e[n],enumerable:!0})},L=(a,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $(e))!H.call(a,i)&&i!==n&&S(a,i,{get:()=>e[i],enumerable:!(t=O(e,i))||t.enumerable});return a};var C=a=>L(S({},"__esModule",{value:!0}),a);var M=(a,e,n)=>e.has(a)||R("Cannot "+n);var u=(a,e,n)=>(M(a,e,"read from private field"),n?n.call(a):e.get(a)),N=(a,e,n)=>e.has(a)?R("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,n),x=(a,e,n,t)=>(M(a,e,"write to private field"),t?t.call(a,n):e.set(a,n),n);var Q={};k(Q,{DataTypeCode:()=>T,NiftiExtension:()=>y,NiftiHeader:()=>E,NiftiIOError:()=>f,NiftiStream:()=>P,NiftiVersion:()=>B,TransformCode:()=>w,UnitsCode:()=>D});var f=class extends Error{constructor(e){super(e),this.name="NiftiIOError"}};var T=(d=>(d[d.UINT8=2]="UINT8",d[d.INT16=4]="INT16",d[d.INT32=8]="INT32",d[d.FLOAT32=16]="FLOAT32",d[d.FLOAT64=64]="FLOAT64",d[d.RGB24=128]="RGB24",d[d.INT8=256]="INT8",d[d.UINT16=512]="UINT16",d[d.UINT32=768]="UINT32",d[d.INT64=1024]="INT64",d[d.UINT64=1280]="UINT64",d))(T||{}),w=(i=>(i[i.SCANNER_ANAT=1]="SCANNER_ANAT",i[i.ALIGNED_ANAT=2]="ALIGNED_ANAT",i[i.TALAIRACH=3]="TALAIRACH",i[i.MNI_152=4]="MNI_152",i))(w||{}),D=(l=>(l[l.METER=1]="METER",l[l.MM=2]="MM",l[l.MICRON=3]="MICRON",l[l.SEC=8]="SEC",l[l.MSEC=16]="MSEC",l[l.USEC=24]="USEC",l[l.HZ=32]="HZ",l[l.PPM=40]="PPM",l[l.RADS=48]="RADS",l))(D||{}),Z=new Map([[2,"Uint8 (1 byte)"],[4,"Int16 (2 bytes)"],[8,"Int32 (4 bytes)"],[16,"Float32 (4 bytes)"],[64,"Float64 (8 bytes)"],[128,"RGB (24-bit)"],[256,"Int8 (1 byte)"],[512,"Uint16 (2 bytes)"],[768,"Uint32 (4 bytes)"],[1024,"Int64 (8 bytes)"],[1280,"Uint64 (8 bytes)"]]),G=new Map([[1,"Scanner Anatomical"],[2,"Aligned Anatomical"],[3,"Talairach Space"],[4,"MNI-152 Space"]]),K=new Map([[1,"Meters (m)"],[2,"Millimeters (mm)"],[3,"Micrometers (\u03BCm)"],[8,"Seconds (s)"],[16,"Milliseconds (ms)"],[24,"Microseconds (\u03BCs)"],[32,"Hertz (Hz)"],[40,"Parts per Million (ppm)"],[48,"Radians (rad)"]]),F=7,A=56;function z(a){return Z.get(a)??"Unknown"}function U(a){return G.get(a)??"Unknown"}function q(a){return K.get(a)??"Unknown"}var m=348,p=540;var _,I,g,b,y=class{constructor({esize:e,ecode:n,edata:t,littleEndian:i}){N(this,_);N(this,I);N(this,g);N(this,b);if(e%16!==0)throw new Error("Invalid NIFTI extension: size must be divisible by 16");x(this,_,e),x(this,I,n),x(this,g,t),x(this,b,i)}get size(){return u(this,_)}get code(){return u(this,I)}get data(){return u(this,g)}get littleEndian(){return u(this,b)}toArrayBuffer(){let e=new Uint8Array(u(this,_)),n=new Uint8Array(u(this,g)),t=new DataView(e.buffer);return t.setInt32(0,u(this,_),u(this,b)),t.setInt32(4,u(this,I),u(this,b)),e.set(n,8),e.buffer}};_=new WeakMap,I=new WeakMap,g=new WeakMap,b=new WeakMap;function c(a,e,n){let t=new Uint8Array(a.buffer,e,n-e),i=t.indexOf(0),s=i===-1?t:t.slice(0,i);return new TextDecoder("ascii").decode(s)}var B=(s=>(s[s.NIFTI1=1]="NIFTI1",s[s.NIFTI1_PAIR=2]="NIFTI1_PAIR",s[s.NIFTI2=3]="NIFTI2",s[s.NIFTI2_PAIR=4]="NIFTI2_PAIR",s[s.NONE=5]="NONE",s))(B||{}),E=class a{constructor(){this.dim_info=0;this.dims=[0,0,0,0,0,0,0,0];this.intent_p1=0;this.intent_p2=0;this.intent_p3=0;this.intent_code=0;this.datatypeCode=0;this.numBitsPerVoxel=0;this.slice_start=0;this.pixDims=[0,0,0,0,0,0,0,0];this.vox_offset=0;this.scl_slope=1;this.scl_inter=0;this.slice_end=0;this.slice_code=0;this.xyzt_units=0;this.cal_max=0;this.cal_min=0;this.slice_duration=0;this.toffset=0;this.description="";this.aux_file="";this.qform_code=0;this.sform_code=0;this.srow_x=[0,0,0,0];this.srow_y=[0,0,0,0];this.srow_z=[0,0,0,0];this.quatern_b=0;this.quatern_c=0;this.quatern_d=0;this.qoffset_x=0;this.qoffset_y=0;this.qoffset_z=0;this.intent_name="";this.magic="ni1";this.littleEndian=!1}isValid(){return this.getNiftiVersion()!==5}getNiftiVersion(){return{"n+1":1,ni1:2,"n+2":3,ni2:4}[this.magic]||5}getNiftiVersionDisplayName(){return{5:"Unknown",1:"NIFTI-1 (Single File)",2:"NIFTI-1 (Paired Files)",3:"NIFTI-2 (Single File)",4:"NIFTI-2 (Paired Files)"}[this.getNiftiVersion()]}getDatatypeDisplayName(){return z(this.datatypeCode)}getQFormDisplayName(){return U(this.qform_code)}getSFormDisplayName(){return U(this.sform_code)}get spatialUnits(){return this.xyzt_units&F}set spatialUnits(e){this.xyzt_units=this.xyzt_units&~F|e&F}get temporalUnits(){return this.xyzt_units&A}set temporalUnits(e){this.xyzt_units=this.xyzt_units&~A|e&A}getSpatialUnitsDisplayName(){return q(this.spatialUnits)}getTemporalUnitsDisplayName(){return q(this.temporalUnits)}computeAffine(){let e=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];if(this.qform_code<1&&this.sform_code<1)e[0][0]=this.pixDims[1],e[1][1]=this.pixDims[2],e[2][2]=this.pixDims[3];else if(this.qform_code>0&&this.sform_code<this.qform_code){let n=Math.sqrt(1-(Math.pow(this.quatern_b,2)+Math.pow(this.quatern_c,2)+Math.pow(this.quatern_d,2))),t=this.quatern_b,i=this.quatern_c,s=this.quatern_d,r=this.pixDims[0]===0?1:this.pixDims[0],o=[[n*n+t*t-i*i-s*s,2*t*i-2*n*s,2*t*s+2*n*i],[2*t*i+2*n*s,n*n+i*i-t*t-s*s,2*i*s-2*n*t],[2*t*s-2*n*i,2*i*s+2*n*t,n*n+s*s-i*i-t*t]];for(let h=0;h<3;h+=1)for(let l=0;l<3;l+=1)e[h][l]=o[h][l]*this.pixDims[l+1],l===2&&(e[h][l]*=r);e[0][3]=this.qoffset_x,e[1][3]=this.qoffset_y,e[2][3]=this.qoffset_z}else if(this.sform_code>0){let n=[this.srow_x,this.srow_y,this.srow_z];for(let t=0;t<3;t+=1)for(let i=0;i<4;i+=1)e[t][i]=n[t][i]}return e}formatHeader(){let e=i=>Number.isInteger(i)?i.toString():i.toFixed(4),n=(i,s=" \xD7 ")=>i.map(e).join(s),t=i=>i.map(r=>r.map(o=>o.toFixed(4).padStart(12)).join("  ")).map(r=>"    "+r).join(`
`);return`# Image Properties
- Version: ${this.getNiftiVersionDisplayName()}
- Datatype: ${this.getDatatypeDisplayName()} [${this.datatypeCode}]
- Bits/Voxel: ${this.numBitsPerVoxel}
- Dimensions: ${n(this.dims)}
- Voxel Size: ${n(this.pixDims)}

# Transform Information
- Q-Form: ${this.getQFormDisplayName()} [${this.qform_code}]
- S-Form: ${this.getSFormDisplayName()} [${this.sform_code}]
- Quaternion B/C/D: ${e(this.quatern_b)} / ${e(this.quatern_c)} / ${e(this.quatern_d)}
- Q-Offset: ${n([this.qoffset_x,this.qoffset_y,this.qoffset_z],", ")}
- S-Form Rows:
    X: ${n(this.srow_x,", ")}
    Y: ${n(this.srow_y,", ")}
    Z: ${n(this.srow_z,", ")}

# Affine Matrix (computed):
${t(this.computeAffine())}

# Units & Scaling
- Spatial Units: ${this.getSpatialUnitsDisplayName()} [${this.spatialUnits}]
- Temporal Units: ${this.getTemporalUnitsDisplayName()} [${this.temporalUnits}]
- Scale Slope: ${e(this.scl_slope)}
- Scale Intercept: ${e(this.scl_inter)}
- Display Range: ${e(this.cal_min)} to ${e(this.cal_max)}

# Intent & Metadata
- Intent: '${this.intent_name||"none"}' [${this.intent_code}]
- Intent Params: ${e(this.intent_p1)} / ${e(this.intent_p2)} / ${e(this.intent_p3)}
- Description: '${this.description||"none"}'
- Auxiliary File: '${this.aux_file||"none"}'`}static peekVersion(e){if(e.byteLength<4)throw new f("Not enough bytes to identify NIFTI header.");switch(e.getInt32(0,!1)){case 348:return{nifti1:!0,littleEndian:!1};case 1543569408:return{nifti1:!0,littleEndian:!0};case 540:return{nifti1:!1,littleEndian:!1};case 469893120:return{nifti1:!1,littleEndian:!0};default:return}}static parse(e,n){return n.nifti1?this.parseNifti1(e,n.littleEndian):this.parseNifti2(e,n.littleEndian)}static parseNifti1(e,n){if(e.byteLength<m)throw new f("Not enough bytes to parse NIFTI-1 header.");let t=new a;if(n===void 0){let s=a.peekVersion(e);if(s===void 0||!s.nifti1)throw new f("This does not appear to be a NIFTI-1 file!");t.littleEndian=s.littleEndian}else t.littleEndian=n;t.dim_info=e.getInt8(39);for(let s=0;s<8;s+=1){let r=40+s*2;t.dims[s]=e.getInt16(r,t.littleEndian)}t.intent_p1=e.getFloat32(56,t.littleEndian),t.intent_p2=e.getFloat32(60,t.littleEndian),t.intent_p3=e.getFloat32(64,t.littleEndian),t.intent_code=e.getInt16(68,t.littleEndian),t.datatypeCode=e.getInt16(70,t.littleEndian),t.numBitsPerVoxel=e.getInt16(72,t.littleEndian),t.slice_start=e.getInt16(74,t.littleEndian);for(let s=0;s<8;s+=1){let r=76+s*4;t.pixDims[s]=e.getFloat32(r,t.littleEndian)}t.vox_offset=e.getFloat32(108,t.littleEndian),t.scl_slope=e.getFloat32(112,t.littleEndian),t.scl_inter=e.getFloat32(116,t.littleEndian),t.slice_end=e.getInt16(120,t.littleEndian),t.slice_code=e.getInt8(122),t.xyzt_units=e.getInt8(123),t.cal_max=e.getFloat32(124,t.littleEndian),t.cal_min=e.getFloat32(128,t.littleEndian),t.slice_duration=e.getFloat32(132,t.littleEndian),t.toffset=e.getFloat32(136,t.littleEndian),t.description=c(e,148,228),t.aux_file=c(e,228,252),t.qform_code=e.getInt16(252,t.littleEndian),t.sform_code=e.getInt16(254,t.littleEndian),t.quatern_b=e.getFloat32(256,t.littleEndian),t.quatern_c=e.getFloat32(260,t.littleEndian),t.quatern_d=e.getFloat32(264,t.littleEndian),t.qoffset_x=e.getFloat32(268,t.littleEndian),t.qoffset_y=e.getFloat32(272,t.littleEndian),t.qoffset_z=e.getFloat32(276,t.littleEndian);let i=[t.srow_x,t.srow_y,t.srow_z];for(let s=0;s<3;s+=1)for(let r=0;r<4;r+=1){let o=280+(s*4+r)*4;i[s][r]=e.getFloat32(o,t.littleEndian)}return t.intent_name=c(e,328,344),t.magic=c(e,344,348),t}static parseNifti2(e,n){if(e.byteLength<p)throw new f("Not enough bytes to parse NIFTI-2 header.");let t=new a;if(n===void 0){let s=a.peekVersion(e);if(s===void 0||s.nifti1)throw new f("This does not appear to be a NIFTI-2 file!");t.littleEndian=s.littleEndian}else t.littleEndian=n;t.magic=c(e,4,12),t.datatypeCode=e.getInt16(12,t.littleEndian),t.numBitsPerVoxel=e.getInt16(14,t.littleEndian);for(let s=0;s<8;s+=1){let r=16+s*8;t.dims[s]=Number(e.getBigInt64(r,t.littleEndian))}t.intent_p1=e.getFloat64(80,t.littleEndian),t.intent_p2=e.getFloat64(88,t.littleEndian),t.intent_p3=e.getFloat64(96,t.littleEndian);for(let s=0;s<8;s+=1){let r=104+s*8;t.pixDims[s]=e.getFloat64(r,t.littleEndian)}t.vox_offset=Number(e.getBigInt64(168,t.littleEndian)),t.scl_slope=e.getFloat64(176,t.littleEndian),t.scl_inter=e.getFloat64(184,t.littleEndian),t.cal_max=e.getFloat64(192,t.littleEndian),t.cal_min=e.getFloat64(200,t.littleEndian),t.slice_duration=e.getFloat64(208,t.littleEndian),t.toffset=e.getFloat64(216,t.littleEndian),t.slice_start=Number(e.getBigInt64(224,t.littleEndian)),t.slice_end=Number(e.getBigInt64(232,t.littleEndian)),t.description=c(e,240,320),t.aux_file=c(e,320,344),t.qform_code=e.getInt32(344,t.littleEndian),t.sform_code=e.getInt32(348,t.littleEndian),t.quatern_b=e.getFloat64(352,t.littleEndian),t.quatern_c=e.getFloat64(360,t.littleEndian),t.quatern_d=e.getFloat64(368,t.littleEndian),t.qoffset_x=e.getFloat64(376,t.littleEndian),t.qoffset_y=e.getFloat64(384,t.littleEndian),t.qoffset_z=e.getFloat64(392,t.littleEndian);let i=[t.srow_x,t.srow_y,t.srow_z];for(let s=0;s<3;s+=1)for(let r=0;r<4;r+=1){let o=280+(s*4+r)*4;i[s][r]=e.getFloat64(o,t.littleEndian)}return t.slice_code=e.getInt32(496,t.littleEndian),t.xyzt_units=e.getInt32(500,t.littleEndian),t.intent_code=e.getInt32(504,t.littleEndian),t.intent_name=c(e,508,524),t.dim_info=e.getInt8(524),t}serializeNifti1(){let e=m,n=new TextEncoder,t=new Uint8Array(e),i=new DataView(t.buffer);i.setInt32(0,m,this.littleEndian),i.setUint8(39,this.dim_info);for(let o=0;o<8;o++)i.setUint16(40+2*o,this.dims[o],this.littleEndian);i.setFloat32(56,this.intent_p1,this.littleEndian),i.setFloat32(60,this.intent_p2,this.littleEndian),i.setFloat32(64,this.intent_p3,this.littleEndian),i.setInt16(68,this.intent_code,this.littleEndian),i.setInt16(70,this.datatypeCode,this.littleEndian),i.setInt16(72,this.numBitsPerVoxel,this.littleEndian),i.setInt16(74,this.slice_start,this.littleEndian);for(let o=0;o<8;o++)i.setFloat32(76+4*o,this.pixDims[o],this.littleEndian);i.setFloat32(108,this.vox_offset,this.littleEndian),i.setFloat32(112,this.scl_slope,this.littleEndian),i.setFloat32(116,this.scl_inter,this.littleEndian),i.setInt16(120,this.slice_end,this.littleEndian),i.setUint8(122,this.slice_code),i.setUint8(123,this.xyzt_units),i.setFloat32(124,this.cal_max,this.littleEndian),i.setFloat32(128,this.cal_min,this.littleEndian),i.setFloat32(132,this.slice_duration,this.littleEndian),i.setFloat32(136,this.toffset,this.littleEndian),t.set(n.encode(this.description.slice(0,80)),148),t.set(n.encode(this.aux_file.slice(0,24)),228),i.setInt16(252,this.qform_code,this.littleEndian),i.setInt16(254,this.sform_code,this.littleEndian),i.setFloat32(256,this.quatern_b,this.littleEndian),i.setFloat32(260,this.quatern_c,this.littleEndian),i.setFloat32(264,this.quatern_d,this.littleEndian),i.setFloat32(268,this.qoffset_x,this.littleEndian),i.setFloat32(272,this.qoffset_y,this.littleEndian),i.setFloat32(276,this.qoffset_z,this.littleEndian);let s=[this.srow_x,this.srow_y,this.srow_z];for(let o=0;o<3;o++)for(let h=0;h<4;h++)i.setFloat32(280+(o*4+h)*4,s[o][h],this.littleEndian);t.set(n.encode(this.intent_name.slice(0,16)),328);let r;switch(this.magic){case"ni2":r="ni1";break;case"n+2":r="n+1";break;default:r=this.magic}return t.set(n.encode(r.slice(0,3)),344),t}serializeNifti2(){let e=new TextEncoder,n=new Uint8Array(p),t=new DataView(n.buffer);t.setInt32(0,p,this.littleEndian);let i;switch(this.magic){case"ni1":i="ni2";break;case"n+1":i="n+2";break;default:i=this.magic}n.set(e.encode(i.slice(0,3)),4),t.setInt16(12,this.datatypeCode,this.littleEndian),t.setInt16(14,this.numBitsPerVoxel,this.littleEndian);for(let r=0;r<8;r++)t.setBigInt64(16+8*r,BigInt(this.dims[r]),this.littleEndian);t.setFloat64(80,this.intent_p1,this.littleEndian),t.setFloat64(88,this.intent_p2,this.littleEndian),t.setFloat64(96,this.intent_p3,this.littleEndian);for(let r=0;r<8;r++)t.setFloat64(104+8*r,this.pixDims[r],this.littleEndian);t.setBigInt64(168,BigInt(this.vox_offset),this.littleEndian),t.setFloat64(176,this.scl_slope,this.littleEndian),t.setFloat64(184,this.scl_inter,this.littleEndian),t.setFloat64(192,this.cal_max,this.littleEndian),t.setFloat64(200,this.cal_min,this.littleEndian),t.setFloat64(208,this.slice_duration,this.littleEndian),t.setFloat64(216,this.toffset,this.littleEndian),t.setBigInt64(224,BigInt(this.slice_start),this.littleEndian),t.setBigInt64(232,BigInt(this.slice_end),this.littleEndian),n.set(e.encode(this.description.slice(0,80)),240),n.set(e.encode(this.aux_file.slice(0,24)),320),t.setInt32(344,this.qform_code,this.littleEndian),t.setInt32(348,this.sform_code,this.littleEndian),t.setFloat64(352,this.quatern_b,this.littleEndian),t.setFloat64(360,this.quatern_c,this.littleEndian),t.setFloat64(368,this.quatern_d,this.littleEndian),t.setFloat64(376,this.qoffset_x,this.littleEndian),t.setFloat64(384,this.qoffset_y,this.littleEndian),t.setFloat64(392,this.qoffset_z,this.littleEndian);let s=[this.srow_x,this.srow_y,this.srow_z];for(let r=0;r<3;r++)for(let o=0;o<4;o++)t.setFloat64(400+(r*4+o)*8,s[r][o],this.littleEndian);return t.setInt32(496,this.slice_code,this.littleEndian),t.setInt32(500,this.xyzt_units,this.littleEndian),t.setInt32(504,this.intent_code,this.littleEndian),n.set(e.encode(this.intent_name.slice(0,16)),508),t.setUint8(524,this.dim_info),n.buffer}};async function V(a){let e=a.getReader(),{done:n,value:t}=await e.read();if(n)return e.releaseLock(),new ReadableStream({start(r){r.close()}});if(!t||t.length<2)return e.releaseLock(),new ReadableStream({start(r){t&&r.enqueue(t),r.close()}});let i=t[0]===31&&t[1]===139,s=new ReadableStream({async start(r){try{for(r.enqueue(t);;){let{done:o,value:h}=await e.read();if(o){r.close(),e.releaseLock();break}r.enqueue(h)}}catch(o){r.error(o),e.releaseLock()}}});return i?s.pipeThrough(new DecompressionStream("gzip")):s}var P=class{constructor(e,n){this.options=n;this.header=null;this.stopped=!1;this.buffer=new Uint8Array(0);this.bufferOffset=0;this.dataPosition=0;this.stream=e}async setup(){let e=await V(this.stream);e&&(this.stream=e),this.reader=this.stream.getReader()}async stop(){this.stopped=!0,await this.reader?.cancel()}async readBytes(e){if(!this.reader)throw new f("Reader not initialized");if(this.buffer.length-this.bufferOffset>=e){let n=this.buffer.slice(this.bufferOffset,this.bufferOffset+e);return this.bufferOffset+=e,n}if(this.buffer.length-this.bufferOffset>0){let n=this.buffer.slice(this.bufferOffset),{done:t,value:i}=await this.reader.read();if(t){if(n.length<e)throw new f(`Unexpected end of stream: needed ${e} bytes but got ${n.length}`);return n}return this.buffer=new Uint8Array(n.length+i.length),this.buffer.set(n),this.buffer.set(i,n.length),this.bufferOffset=0,this.readBytes(e)}else{let{done:n,value:t}=await this.reader.read();if(n)throw new f(`Unexpected end of stream: needed ${e} bytes but got 0`);return this.buffer=t,this.bufferOffset=0,this.readBytes(e)}}async readHeader(){let e=await this.readBytes(m),n=E.peekVersion(new DataView(e.buffer));if(!n)throw new f("Not a valid NIFTI file");if(!n.nifti1){let t=await this.readBytes(p-m),i=new Uint8Array(p);return i.set(e),i.set(t,m),E.parseNifti2(new DataView(i.buffer),n.littleEndian)}return E.parseNifti1(new DataView(e.buffer),n.littleEndian)}async readExtension(){if(!this.header||!this.reader)throw new f("Cannot read extension before header");if((await this.readBytes(4))[0]===0)return null;let n=await this.readBytes(8),t=this.header.littleEndian,i=new DataView(n.buffer),s=i.getInt32(0,t),r=i.getInt32(4,t),o=s-8,h=await this.readBytes(o);return new y({esize:s,ecode:r,edata:h.buffer,littleEndian:t})}async readNextSlice(){if(!this.header)throw new f("Cannot read slice before header");if(!this.options.sliceDimension){if(this.dataPosition===0&&this.buffer.length>this.bufferOffset){let o=this.buffer.slice(this.bufferOffset);return this.buffer=new Uint8Array(0),this.bufferOffset=0,this.dataPosition++,{data:o.buffer,indices:[]}}let{done:s,value:r}=await this.reader.read();return s?null:(this.dataPosition++,{data:r.buffer,indices:[]})}let e=this.header.dims[0],n=this.header.dims,i=this.header.numBitsPerVoxel/8;for(let s=1;s<=(this.options.sliceDimension||2);s++)n[s]>0&&(i*=n[s]);try{let s=await this.readBytes(i),r=new Array(e).fill(0);return r[this.options.sliceDimension+1]=this.dataPosition++,{data:s.buffer,indices:r}}catch(s){if(s instanceof f)return null;throw s}}async start(){if(await this.setup(),!!this.reader)try{if(this.stopped)return;if(this.header=await this.readHeader(),this.options.onHeader){if(await this.options.onHeader(this.header)){await this.stop();return}}else if(!this.options.onExtension&&!this.options.onSlice){await this.stop();return}if(!this.stopped){let e=await this.readExtension();if(this.options.onExtension){if(await this.options.onExtension(e)){await this.stop();return}}else if(!this.options.onSlice){await this.stop();return}}if(!this.options.onSlice){await this.stop();return}for(;!this.stopped;){let e=await this.readNextSlice();if(!e)break;if(await this.options.onSlice(e.data,e.indices,this.header)){await this.stop();break}}}catch(e){this.options.onError&&this.options.onError(e)}finally{this.reader.releaseLock()}}};return C(Q);})();
//# sourceMappingURL=nifti-stream.js.map
